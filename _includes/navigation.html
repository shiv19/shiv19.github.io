<style>
ul#dropdown-menu-freebie { display: inline-block; list-style: none; margin: 0 auto; padding: 0; }
ul#dropdown-menu-freebie > li:last-child { margin-right: 0; }
ul.dropdown-menu li ul {
    display: none;
    list-style: none;
    text-align: left;
}

ul.dropdown-menu li:hover ul,
ul.dropdown-menu li.open ul {
    display: table;
    margin: 0 auto;
    position: absolute;
    z-index: 1000;
}

ul.dropdown-menu {
    padding: 0 20px;
    border-radius: 10px;
    list-style: none;
    position: relative;
    margin: 0;
}

ul.dropdown-menu::after {
    content: "";
    display: table;
    margin: 0 auto;
}

ul.dropdown-menu li a {
    display: block;
    text-decoration: none;
}

ul.dropdown-menu > li {
    border-radius: 8px;
}

ul.dropdown-menu > li > a {
    position: relative;
    z-index: 0;
}

ul.dropdown-menu ul {
    border-radius: 16px;
    padding: 6px 0;
    background: var(--dropdown-bg);
    border: 1px solid var(--dropdown-border);
    box-shadow: var(--dropdown-shadow);
    min-width: 150px;
}

ul.dropdown-menu ul li {
    float: none;
    position: relative;
    border-bottom: 1px solid var(--dropdown-border);
}

ul.dropdown-menu ul li a {
    font-size: 13px;
    padding: 9px 12px;
    margin: 4px 6px;
    width: calc(100% - 12px);
    color: var(--color-text-primary);
    background: var(--dropdown-bg);
    border-radius: 8px;
    box-sizing: border-box;
    transition: all 0.3s cubic-bezier(.25,.8,.25,1);
}

ul.dropdown-menu ul li:first-child a {
    margin-top: 0;
}

ul.dropdown-menu ul li:last-child a {
    margin-bottom: 0;
}

ul.dropdown-menu ul li a:hover {
    background: var(--dropdown-hover-bg);
}

ul.dropdown-menu ul li:last-child {
    border-bottom: none;
}

.current {
    text-decoration: underline;
}

.nav-links {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
}

.nav-actions {
    display: inline-flex;
    align-items: center;
    gap: 12px;
    margin-left: 20px;
}

.nav-actions a {
    margin-left: 0;
}

@media (max-width: 600px) {
    .nav-links {
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
        width: 100%;
    }

    .nav-actions {
        margin-left: 0;
        margin-top: 12px;
        width: 100%;
        justify-content: flex-start;
        gap: 16px;
    }

    ul#dropdown-menu-freebie {
        display: block;
        width: 100%;
        margin: 0;
        padding: 0;
    }

    ul.dropdown-menu {
        padding: 0;
        margin: 0;
        width: 100%;
    }

    ul.dropdown-menu > li > a {
        text-align: left;
        padding-left: 0;
    }

    .nav-actions .super-search-btn,
    .nav-actions .theme-toggle-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1px solid var(--color-border);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0;
    }

    .nav-actions .theme-toggle-btn svg {
        width: 18px;
        height: 18px;
    }
}
</style>
{% for entry in site.data.navigation %}
{% capture fullurl %}{{ site.baseurl }}{{ entry.url }}{% endcapture %}
    {% if fullurl == page.url %}
        {% assign current_page = fullurl %}
        {% break %}
    {% elsif page.url contains fullurl %}
        {% assign current_page = fullurl %}
    {% endif %}
{% endfor %}

<nav>
    <div class="nav-links">
    {% for entry in site.data.navigation %}
        {% if entry.url == current_page %}
        {% assign current = ' class="current"' %}
        {% else %}
            <!-- We have to declare it 'null' to ensure it doesn't propagate. -->
            {% assign current = null %}
        {% endif %}
        {% assign sublinks = entry.sublinks %}
        {% if sublinks %}
        {% else %}
            <a{{ current }} href="{{ site.baseurl }}{{ entry.url }}">{{ entry.title }}</a>
        {% endif %}
        <ul id="dropdown-menu-freebie">
            <li>
                {% if sublinks %}
                <ul class="dropdown-menu">
                    <li class="dropdown-item{{ current }}">
                        <a href="javascript:void(0)" class="dropdown-toggle" aria-haspopup="true" aria-expanded="false">{{ entry.title }}â–¾</a>
                        <ul>
                            {% for sublink in sublinks %}
                            <li><a href="{{ site.baseurl }}{{ sublink.url }}">{{ sublink.title }}</a></li>
                            {% endfor %}
                        </ul>
                    </li>
                </ul>
                {% endif %}
            </li>
        </ul>
    {% endfor %}
    </div>
    <div class="nav-actions">
            <a href="javascript:void(0)" title="Search (Esc or '/')" aria-label="Open site search" onclick="toggleSearch()" class="super-search-btn">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M15.5 14h-.79l-.28-.27a6 6 0 1 0-.71.71l.27.28v.79L20 21.5 21.5 20zM10 15a5 5 0 1 1 0-10 5 5 0 0 1 0 10z"></path>
                </svg>
            </a>
            <a href="javascript:void(0)" onclick="toggleTheme()" title="Toggle Theme" class="theme-toggle-btn">
                <svg class="icon-moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
                <svg class="icon-sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
            </a>
        </div>
</nav>

<script>
(function() {
    document.addEventListener('DOMContentLoaded', function() {
        var dropdownToggles = document.querySelectorAll('nav .dropdown-toggle');
        var mobileQuery = window.matchMedia('(max-width: 600px)');

        dropdownToggles.forEach(function(toggle) {
            toggle.addEventListener('click', function(event) {
                if (!mobileQuery.matches) {
                    return;
                }

                event.preventDefault();
                var parentItem = toggle.closest('.dropdown-item');
                if (!parentItem) {
                    return;
                }

                var isOpen = parentItem.classList.contains('open');
                document.querySelectorAll('nav .dropdown-item.open').forEach(function(item) {
                    item.classList.remove('open');
                    var btn = item.querySelector('.dropdown-toggle');
                    if (btn) {
                        btn.setAttribute('aria-expanded', 'false');
                    }
                });

                if (!isOpen) {
                    parentItem.classList.add('open');
                    toggle.setAttribute('aria-expanded', 'true');
                }
            });
        });
    });
})();
</script>
